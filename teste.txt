'use client'

import React from 'react'
import { useRouter } from 'next/navigation'

interface Funcionario {
  id: number;
  nome: string;
  sobrenome: string;
  email: string;
  telefone: string;
}

export default function ListarFuncionario() {
  const [funcionarios, setFuncionarios] = React.useState<Funcionario[]>([])
  const router = useRouter();

  const fetchData = async () => {
    const response = await fetch('http://localhost:3000/funcionarios')
    const data = await response.json()
    setFuncionarios(data)
  }

  React.useEffect(() => {
    fetchData()
  }, [])

  function isFuncionario(funcionario: any): funcionario is Funcionario {
    return funcionario && funcionario.id !== undefined
  }

  return (
    <div>
      <div className='flex gap-10'>
      <p>Nome</p>
      <p>Sobrenome</p>
      <p>E-mail</p>
      <p>Telefone</p>
      <p>Ações</p>
      </div>
      {funcionarios.map((funcionario) => (
        
        <div className='flex gap-5' key={funcionario.id}>
          <p >{funcionario.nome}</p>
          <p>{funcionario.sobrenome}</p>
          <p>{funcionario.email}</p>
          <p>{funcionario.telefone}</p>
          <button 
            onClick={() => {
              if (isFuncionario(funcionario)) {
                fetch(`http://localhost:3000/funcionarios/${funcionario.id}`, {
                  method: 'DELETE'
                })
                .then(() => fetchData())
              }
            }}
          >Deletar</button>
          <button
            onClick={() => {
              if (isFuncionario(funcionario)) {
                router.push(`/funcionario/${funcionario.id}/editar`)
              }
            }}
          >Editar</button>
        </div>

      ))};
    </div>
  )
}